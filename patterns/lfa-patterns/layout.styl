// Because reasons.
html, body
  height: 100%
  width: 100%

// "Holy Grail" layout, with left and right sidebar.
body
  // Actual content/chapter should take up all available height; so we can click anywhere
  // to close the sidebars.
  #content, #textbook
    height: 100%
  
  // The fixed top menu that contains the sidebar buttons.
  .menu
    position: fixed
    top: 0
    width: 100%
    z-index: 1000
    color: white
    
  // Position the sidebar buttons correctly and style them.
  #leftbar-toggle, #rightbar-toggle
    position: absolute
    width: toggleHitbox
    height: toggleHitbox
    cursor: pointer
    top: 1.5em
    background: #222
    > i
      position: absolute
      font-size: 1.5em
  
  #leftbar-toggle
    left: 1.5em
    > i
      top: 0.50em
      left: 0.37em
  
  #rightbar-toggle
    right: 1.5em
    > i
      top: 0.45em
      right: 0.40em
  
  @media max-tablet
    #leftbar-toggle
      top: 0.75em
      left: 0.75em
    
    #rightbar-toggle
      top: 0.75em
      right: 0.75em
  
  // Make the menu fade out when we scroll down.
  .menu
    &.pinned
      opacity: 1
    
    &.unpinned
      opacity: 0.1
  
  // But fade it back in if we actually activate one of the toggles.
  &.leftbar-active .menu.unpinned
  &.rightbar-active .menu.unpinned
    opacity: 1
  
  // Change the top buttons to be part of a solid navbar on mobiles.
  @media max-phone
    .menu
      height: 3em
      background: #222
      
      // Hide the menu when we scroll down on mobile.
      &.pinned
        transform: translate3d(0, 0, 0)
      
      &.unpinned
        transform: translate3d(0, -3em, 0)
    
    #leftbar-toggle, #rightbar-toggle
      top: 0
    
    #leftbar-toggle
      left: 0
      > i
        left: 12px
    
    #rightbar-toggle
      right: 0
      > i
        right: 12px
    
    #content
      margin-top: 3em
  
  // Position the sidebars correctly and configure overflows.
  #leftbar
  #rightbar
    width: sidebarWidth
    position: fixed
    height: 100%
    top: 0px
    overflow-y: auto
    overflow-x: hidden

  #leftbar
    left: - sidebarWidth
    z-index: 1000

  #rightbar
    right: - sidebarWidth
    z-index: 1010
  
  // Animate the sidebars into view when they get activated. Move the entire page.
  &.leftbar-active
    #leftbar-toggle, #leftbar
      transform: translate3d(sidebarWidth, 0, 0)
    #content
      transform: translate3d((sidebarWidth * 0.5), 0, 0)
    // Make the other sidebar-toggle dissapear when you open a sidebar.
    #rightbar-toggle
      transform: translate3d(toggleHitbox, 0, 0)
      opacity: 0
  
  &.rightbar-active
    #rightbar-toggle, #rightbar
      transform: translate3d(- sidebarWidth, 0, 0)
    #content
      transform: translate3d((sidebarWidth * -0.5), 0, 0)
    #leftbar-toggle
      transform: translate3d(- toggleHitbox, 0, 0)
      opacity: 0
  
  // Fade out the content when we're on a tablet or smaller device.
  @media max-tablet
    &.leftbar-active
    &.rightbar-active
      #content
        opacity: 0.2

// Animation durations. Turning these off will usually improve performance, and always
// improve productivity. (having something happen instantly is better than after 0.3s)
body.animated
  hoverduration = tduration / 3
  
  transition: tduration padding ease
  
  .menu
    transition: transform tduration ease\, opacity tduration ease
  
  #content
    transition: transform tduration ease\, opacity tduration ease
  
  #leftbar
  #rightbar
    transition: transform tduration ease
  
  #leftbar
    ul li a
      transition: background hoverduration linear
  
  #leftbar-toggle, #rightbar-toggle
    transition: transform tduration ease\, opacity tduration ease
    > i
      transition: transform tduration ease
  
  #search-go, #search-erase
    transition: transform tduration ease
  
  #search-results li a
    transition: background hoverduration ease
    .title, .body
      transition: color hoverduration ease
  
  #animations-toggle
    transition: background hoverduration ease

// Special rules for Apple iOS devices.
html.appleios body
  overflow: hidden
  
  #leftbar
  #rightbar
  #content
    -webkit-overflow-scrolling: touch
  
  &.leftbar-active
  &.rightbar-active
    overflow-y: auto

// // This rule is used to stop the body element from scrolling when a sidebar is in focus.
// body.leftbar-active, body.rightbar-active, body.no-scroll
//   overflow: hidden

#content
  @extend .container
  
  #textbook
    @extend .row
    
    > article
      @extend .col-lg-8
      @extend .col-lg-offset-2
      
      @extend .col-md-10
      @extend .col-md-offset-1
      
      @extend .col-sm-10
      @extend .col-sm-offset-1
      
      @extend .col-xs-12
  

// Color the sidebars.
body #leftbar
body #rightbar
  font-family: $font-family-sans-serif
  background: sidebarBackground
  color: sidebarTextColor
  padding-top: 1.5em
  @media max-phone
    padding-top: 0

// The left sidebar, with the table of contents.
body #leftbar
  ul
    list-style-type: none
    padding: 0
    
    li
      cursor: pointer
    
    a
      color: sidebarTextColor
      height: (sidebarTextSize * 3)
      width: 100%
      display: block
      letter-spacing: 1px
      padding: 0 halfGutter
      text-decoration: none
      
      .title, .subtitle
        display: block
        text-overflow: ellipsis
        white-space: nowrap
        overflow: hidden
      
      .title
        font-size: sidebarTextSize
        line-height: (sidebarTextSize * 3)
      
      &.subtitled
        .title
          padding-top: (sidebarTextSize * 0.5)
          line-height: sidebarTextSize
        
        .subtitle
          line-height: sidebarTextSize
          font-size: (sidebarTextSize * 0.75)
          padding-top: (sidebarTextSize * 0.25)
          padding-bottom: (sidebarTextSize * 0.75)
          color: rgba(255, 255, 255, 0.5)
          letter-spacing: 0px
    
    li.active > a, li > a:focus
      background: sidebarHoverBg
      text-decoration: none
  
  > ul > li > ul > li
    // Second level chapters.
    > a
      padding-left: halfGutter + 10px
    
    > ul > li a
      // Third level chapters and beyond.
      padding-left: halfGutter + 20px

// Rules for devices with no touch support. Hover states and the like.
html.no-touch body
  #leftbar ul li a:hover
    background: sidebarHoverBg
    text-decoration: none
    
  #rightbar #search ul#search-results li a:hover
    background: lighten(sidebarSearchResultBg, 10%)
    .title, .body
      color: lighten(sidebarTextColor, 10%)

// Some extra padding for first (only?) article in a chapter, so that it doesn't interfere
// with the menu.
#textbook > article:first-child
  padding-top: 0

// The right sidebar, with the search and the notes.
body #rightbar
  .settings
    #animations-toggle
      @extend .btn
      @extend .btn-success
      @extend .btn-lg
      @extend .btn-block
      
      background: sidebarSearchBg
      border: none
      
      font-size: 1.25em
      line-height: 2.4em
      padding: 0
      
      &:hover, &:focus
        background: lighten(sidebarSearchBg, 10%)
      
      &.active
        color: darken(#fff, 30%)
        background: darken(sidebarSearchBg, 10%)
  
  #search
    margin-bottom: 1.5em
    background: sidebarSearchBg
    position: relative
    
    // Fixes a really weird iOS-only bug that makes the entire thing overflow off-canvas.
    overflow-x: hidden
    overflow-y: hidden
    
    #search-go, #search-erase
      position: absolute
      top: 0
      right: 0
      cursor: pointer
      height: toggleHitbox + 3px
      width: toggleHitbox
      > i
        padding-top: 18px
        padding-left: 20px
        font-size: sidebarTextSize
      
      > i.fa-search
        padding-left: 18px
      
      &.concealed
        transform: translate3d(toggleHitbox, 0, 0)
    
    input
      cursor: pointer
      margin: 0
      padding: 0.75em
      height: 3em
      border: 0
      border-radius: 0
      width: 100%
      background: sidebarSearchResultBg
      color: sidebarTextColor
      placeholder(sidebarTextColor)
      font-size: sidebarTextSize
    
    #search-results
      list-style-type: none
      padding: 0
      margin: 0
      
      li
        cursor: pointer
    
      a
        color: sidebarTextColor
        height: 100%
        width: 100%
        display: block
        padding: 0.75em
        font-size: sidebarTextSize
        font-weight: 200
        letter-spacing: 1px
        background: sidebarSearchResultBg
      
        &:hover
          color: @color
          text-decoration: none
      
        .title, .body
          display: block
      
        .body
          font-size: 1em
          color: darken(@color, 10%)
          letter-spacing: 0px
          overflow: hidden
          line-height: 1.5em
          height: 3em // 2 lines exactly.
